<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Test Wheel</title>
  <style>
    body { text-align: center; font-family: Arial; }
    canvas { margin-top: 20px; }
    #status { margin-top: 20px; font-size: 18px; color: green; }
  </style>
</head>
<body>
  <h1>ðŸŽ¡ Test Wheel</h1>
  <input type="number" id="stopNumber" placeholder="Enter Stop Number (0-9)">
  <button onclick="startWheel()">Start</button>

  <canvas id="wheelCanvas" width="400" height="400"></canvas>
  <div id="status">Status: Idle</div>

  <script src="http://localhost:3000/socket.io/socket.io.js"></script>
<script>
  const socket = io("http://localhost:3000");
  const canvas = document.getElementById("wheelCanvas");
  const ctx = canvas.getContext("2d");
  const center = canvas.width / 2;
  const numbers = [0,1,2,3,4,5,6,7,8,9];
  let currentAngle = 0;

  function drawWheel() {
    const slice = (2 * Math.PI) / numbers.length;
    for (let i = 0; i < numbers.length; i++) {
      ctx.beginPath();
      ctx.moveTo(center, center);
      ctx.fillStyle = i % 2 === 0 ? "#f1c40f" : "#e67e22";
      ctx.arc(center, center, center, i*slice+currentAngle, (i+1)*slice+currentAngle);
      ctx.fill();
      ctx.save();
      ctx.translate(center, center);
      ctx.rotate(i * slice + slice/2 + currentAngle);
      ctx.fillStyle = "#000";
      ctx.font = "20px Arial";
      ctx.fillText(numbers[i], center-50, 10);
      ctx.restore();
    }
  }

  function render() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    drawWheel();
  }

  render();

  function startWheel() {
    const stopNum = parseInt(document.getElementById("stopNumber").value);
    if (isNaN(stopNum)) { alert("Enter number!"); return; }
    socket.emit("startWheel", { stopNumber: stopNum });
  }

  socket.on("statusUpdate", (msg) => {
    document.getElementById("status").innerText = "Status: " + msg;
  });

  socket.on("rotate", ({ angle }) => {
    currentAngle = angle;
    render();
  });

  socket.on("finalNumber", (num) => {
    const slice = (2*Math.PI)/numbers.length;
    currentAngle = (10 - num) * slice;
    render();
  });
</script>
</body>
</html>
